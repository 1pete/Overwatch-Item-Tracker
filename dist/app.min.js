var OWI=angular.module("OWI",["ui.router","ui.bootstrap","ngAnimate"]);OWI.config(["$compileProvider","$urlMatcherFactoryProvider","$animateProvider","$locationProvider",function(e,t,r,n){n.hashPrefix(""),e.debugInfoEnabled(!1),t.strictMode(!1),r.classNameFilter(/angular-animate/)}]),OWI.run(function(){console.info("Starting Migrations");var e=localStorage.getItem("data"),t=!!e&&JSON.parse(e),r=[{name:"Fix Ornament Sprays",id:0,run:function(){if(t.winterwonderland2016&&t.winterwonderland2016.sprays){var e=["ana-warm-ornament","bastion-festive-ornament","dva-cookie-ornament","genji-kadomatsu-ornament","hanzo-kadomatsu-ornament","junkrat-winter-ornament","lucio-hockey-ornament","mccree-ugly-sweater-ornament","mei-sculpting-ornament","mercy-snow-angel-ornament","pharah-ice-fishing-ornament","reaper-stocking-ornament","reinhardt-ice-fishing-ornament","roadhog-winter-ornament","soldier-76-army-man-76-ornament","sombra-puppet-ornament","symmetra-snowflake-ornament","torbjorn-workshop-ornament","tracer-snowboarding-ornament","widowmaker-skiing-ornament","winston-presents-ornament","zarya-matryoshka-ornament","zenyatta-snowball-fight-ornament"],r={};for(var n in t.winterwonderland2016.sprays){var a=t.winterwonderland2016.sprays[n];e.includes(n)?r[n.split("-")[0]+"-ornament"]=a:r[n]=a}t.winterwonderland2016.sprays=r}}},{name:"Fix voice, poses and skins mappings",id:1,run:function(){for(var e in t){if(!(t.summergames2016||t.winterwonderland2016||t.halloween2016||t.yearoftherooster2017))return;e=t[e],e.voicelines=Object.assign({},e.voicelines,e.voice),e.poses=Object.assign({},e.poses,e.victoryposes),e.skinsEpic=Object.assign({},e.skinsEpic,e.epic),e.skinsLegendary=Object.assign({},e.skinsLegendary,e.legendary),delete e.voice,delete e.legendary,delete e.epic,delete e.victoryposes}}},{name:"Convert Halloween and SummerGames to new Data",id:2,run:function(){var e={halloween2016:{skinsLegendary:{"Junkenstein Junkrat":"junkrat-dr-junkenstein","Monster Roadhog":"roadhog-junkensteins-monster","Witch Mercy":"mercy-witch","Pumpkin Reaper":"reaper-pumpkin"},skinsEpic:{"Ghoul Ana":"ana-ghoul","Tombstone Bastion":"bastion-tombstone","Demon Hanzo":"hanzo-demon","Possessed Pharah":"pharah-possessed","Coldhardt Reinhardt":"reinhardt-coldhardt","Immortal Soldier: 76":"soldier-76-immortal","Vampire Symmetra":"symmetra-vampire","Skullyata Zenyatta":"zenyatta-skullyatta"},emotes:{"Candy Ana":"ana-candy","Pumpkin Smashing Reinhardt":"reinhardt-pumpkin-smash","Shadow Puppets Winston":"winston-shadow-puppets"},intros:{"Pumpkin Carving Genji":"genji-pumpkin-carving","Ice Scream Mei":"mei-ice-scream","Eternal Rest Reaper":"reaper-eternal-rest"},sprays:{Ana:"ana-trick-or-treat",Bastion:"bastion-trick-or-treat","D.Va":"dva-trick-or-treat",Genji:"genji-trick-or-treat",Hanzo:"hanzo-trick-or-treat",Junkrat:"junkrat-trick-or-treat","LÚcio":"lucio-trick-or-treat",McCree:"mccree-trick-or-treat",Mei:"mei-trick-or-treat",Mercy:"mercy-trick-or-treat",Pharah:"pharah-trick-or-treat",Reaper:"reaper-trick-or-treat",Reinhardt:"reinhardt-trick-or-treat",Roadhog:"roadhog-trick-or-treat","Soldier: 76":"soldier-76-trick-or-treat",Symmetra:"symmetra-trick-or-treat","TorbjÖrn":"torbjorn-trick-or-treat",Tracer:"tracer-trick-or-treat",Widowmaker:"widowmaker-trick-or-treat",Winston:"winston-trick-or-treat",Zarya:"zarya-trick-or-treat",Zenyatta:"zenyatta-trick-or-treat","...Never Die":"never-die",Bats:"bats","Boo!":"boo","Boop!":"boop",Candyball:"candyball",Fangs:"fangs","Gummy Hog":"gummy-hog","Halloween Terror":"halloween-terror-2016",Pumpkins:"pumpkins","Witch's Brew":"witchs-brew"},voicelines:{Ana:"ana-are-you-scared",Bastion:"bastion-wwwooooo","D.Va":"dva-happy-halloween",Genji:"genji-my-halloween-costume",Hanzo:"hanzo-you-are-already-dead",Junkrat:"junkrat-happy-halloween","LÚcio":"lucio-killed-it",McCree:"mccree-its-your-funeral",Mei:"mei-scary",Mercy:"mercy-superstition",Pharah:"pharah-dead-or-alive",Reaper:"reaper-i-work-the-graveyard-shift",Reinhardt:"reinhardt-smashing",Roadhog:"roadhog-want-some-candy","Soldier: 76":"soldier-76-knock-knock",Symmetra:"symmetra-a-frightening-thought","TorbjÖrn":"torbjorn-if-you-build-it",Tracer:"tracer-ooh-scary",Widowmaker:"widowmaker-the-party-is-over",Winston:"winston-this-is-not-a-costume",Zarya:"zarya-never-forget-the-fallen",Zenyatta:"zenyatta-trick-or-treat"},poses:{Ana:"ana-rip",Bastion:"bastion-rip","D.Va":"dva-rip",Genji:"genji-rip",Hanzo:"hanzo-rip",Junkrat:"junkrat-rip","LÚcio":"lucio-rip",McCree:"mccree-rip",Mei:"mei-rip",Mercy:"mercy-rip",Pharah:"pharah-rip",Reaper:"reaper-rip",Reinhardt:"reinhardt-rip",Roadhog:"roadhog-rip","Soldier: 76":"soldier-76-rip",Symmetra:"symmetra-rip","TorbjÖrn":"torbjorn-rip",Tracer:"tracer-rip",Widowmaker:"widowmaker-rip",Winston:"winston-rip",Zarya:"zarya-rip",Zenyatta:"zenyatta-rip"},icons:{"...Never Die":"never-die",Bewitching:"bewitching",Calavera:"calavera",Candle:"candle",Eyeball:"eyeball",Ghostymari:"ghostymari","Halloween Terror 2016":"halloween-terror",Spider:"spider",Superstition:"superstition","The Doctor":"junkrat-the-doctor","The Monster":"roadhog-the-monster","The Reaper":"reaper-the-reaper","The Witch":"mercy-the-witch",Tombstone:"tombstone",Vampachimari:"vampachimari","Witch's Brew":"witchs-brew","Witch's Hat":"witchs-hat",Wolf:"wolf"}},summergames2016:{skinsLegendary:{Selecao:"lucio-selecao",Striker:"lucio-striker",Sprinter:"tracer-sprinter","Track & Field":"tracer-track-and-field",Weightlifter:"zarya-weightlifter",Champion:"zarya-champion"},skinsEpic:{"Taegeukgi D.Va":"dva-taegeukgi","Nihon Genji":"genji-nihon","American Mccree":"mccree-american","Edigenossin Mercy":"mercy-eidgenossin","Tre Kronor TorbjÖrn":"torbjorn-tre-kronor","Tricolore Widowmaker":"widowmaker-tricolore"},emotes:{"Boxing Bastion":"bastion-boxing","Juggle LÚcio":"lucio-juggle","Ribbon Symmetra":"symmetra-ribbon"},intros:{"Shotput Junkrat":"junkrat-shot-put","Bicycle Kick LÚcio":"lucio-bicycle-kick","Hurdle Tracer":"tracer-hurdle"},sprays:{Ana:"ana-shooting",Bastion:"bastion-boxing","D.Va":"dva-cycling",Genji:"genji-fencing",Hanzo:"hanzo-archery",Junkrat:"junkrat-tennis","LÚcio":"lucio-football",McCree:"mccree-equestrian",Mei:"mei-table-tennis",Mercy:"mercy-badminton",Pharah:"pharah-basketball",Reaper:"reaper-bmx",Reinhardt:"reinhardt-wrestling",Roadhog:"roadhog-diving","Soldier: 76":"soldier-76-golf",Symmetra:"symmetra-rhythmic","TorbjÖrn":"torbjorn-water-polo",Tracer:"tracer-track",Widowmaker:"widowmaker-gymnastics",Winston:"winston-volleyball",Zarya:"zarya-weightlifting",Zenyatta:"zenyatta-taekwondo","Summer Games 2016":"summer-games"},voicelines:{Ana:"ana-learn-from-the-pain",Bastion:"bastion-whoovweeeeee","D.Va":"dva-im-1",Genji:"genji-i-was-hoping-for-a-challenge",Hanzo:"hanzo-ignore-all-distractions",Junkrat:"junkrat-i-give-it-a-10","LÚcio":"lucio-be-champions",McCree:"mccree-i-dont-much-like-losing",Mei:"mei-overcome-all-obstacles",Mercy:"mercy-piece-of-cake",Pharah:"pharah-we-are-in-this-together",Reaper:"reaper-its-in-the-refrigerator",Reinhardt:"reinhardt-100-german-power",Roadhog:"roadhog-whats-mine-is-mine","Soldier: 76":"soldier-76-you-want-a-medal",Symmetra:"symmetra-hard-work-and-dedication","TorbjÖrn":"torbjorn-more-where-that-came-from",Tracer:"tracer-eat-my-dust",Widowmaker:"widowmaker-i-dont-miss",Winston:"winston-playtimes-over",Zarya:"zarya-no-pain-no-gain",Zenyatta:"zenyatta-strive-for-improvement"},poses:{Mei:"mei-medal",Pharah:"pharah-medal",Reaper:"reaper-medal",Roadhog:"roadhog-medal","Soldier: 76":"soldier-76-golf-swing","TorbjÖrn":"torbjorn-medal",Widowmaker:"widowmaker-medal",Winston:"winston-medal",Zenyatta:"zenyatta-medals"},icons:{Archery:"hanzo-archery",Badminton:"mercy-badminton",Basketball:"pharah-basketball",BMX:"reaper-bmx",Boxing:"bastion-boxing",Cycling:"dva-cycling",Equestrian:"mccree-equestrian",Diving:"roadhog-diving",Fencing:"genji-fencing",Football:"lucio-football",Golf:"soldier-76-golf",Gymnastics:"widowmaker-gymnastics","Rhythmic Gymnastics":"symmetra-rhythmic-gymnastics",Shooting:"ana-shooting","Table Tennis":"mei-table-tennis",Taekwondo:"zenyatta-taekwondo",Tennis:"junkrat-tennis",Track:"tracer-track",Volleyball:"winston-volleyball","Water Polo":"torbjorn-water-polo",Weightlifting:"zarya-weightlifting",Wrestling:"reinhardt-wrestling","Summer Games":"summer-games",Australia:"australia",Brazil:"brazil",China:"china",Egypt:"egypt",France:"france",Germany:"germany",Greece:"greece",Japan:"japan",Mexico:"mexico",Nepal:"nepal",Numbani:"numbani",Russia:"russia","South Korea":"south-korea",Sweden:"sweden",Switzerland:"switzerland","United Kingdom":"united-kingdom","United States":"united-states"}}};for(var r in t){if("halloween2016"!=r||"summergames2016"!==r)return;var n=t[r];for(var a in n)for(var i in n[a]){if(!(i in e[r][a]))return;n[a][e[r][a][i]]=n[a][i],delete n[a][i]}}}},{name:"Fix Bokimario",id:3,run:function(){t.yearoftherooster2017&&t.yearoftherooster2017.icons&&t.yearoftherooster2017.icons.bokimario&&(t.yearoftherooster2017.icons.bokimari=t.yearoftherooster2017.icons.bokimario,delete t.yearoftherooster2017.icons.bokimario)}},{name:"Rename events to their proper IDs",id:4,run:function(){(t.summergames2016||t.winterwonderland2016||t.halloween2016||t.yearoftherooster2017)&&(t.SUMMER_GAMES_2016=Object.assign({},t.summergames2016,t.SUMMER_GAMES_2016),t.HALLOWEEN_2016=Object.assign({},t.halloween2016,t.HALLOWEEN_2016),t.WINTER_WONDERLAND_2016=Object.assign({},t.winterwonderland2016,t.WINTER_WONDERLAND_2016),t.YEAR_OF_THE_ROOSTER_2017=Object.assign({},t.yearoftherooster2017,t.YEAR_OF_THE_ROOSTER_2017),delete t.summergames2016,delete t.halloween2016,delete t.winterwonderland2016,delete t.yearoftherooster2017)}},{name:"Update event item IDs and rename new Rooster IDs",id:5,run:function(){var e={SUMMER_GAMES_2016:{sprays:{"summer-games":"summer-games-2016"},icons:{"summer-games":"summer-games-2016","united-states":"united-states-of-america"}},HALLOWEEN_2016:{sprays:{"halloween-terror-2016":"halloween-terror",halloweenspecial:"halloween-special",junkensteinsrevenge:"junkensteins-revenge",riseofthezomnics:"rise-of-the-zomnics",thereapening:"the-reapening"},icons:{"halloween-terror":"halloween-terror-2016"}},WINTER_WONDERLAND_2016:{icons:{"winter-wonderland":"winter-wonderland-2016"}},YEAR_OF_THE_ROOSTER_2017:{skinsEpic:{"mercy-golden":"mercy-fortune"},icons:{"roadhog-piggy":"roadhog-pigsy","year-of-the-rooster":"year-of-the-rooster-2017"}}};for(var r in e){if(!t[r])break;for(var n in e[r])for(var a in e[r][n])t[r][n][e[r][n][a]]=t[r][n][a],delete t[r][n][a]}}},{name:"Move all event data to hero data",id:6,run:function(){var e=["SUMMER_GAMES_2016","WINTER_WONDERLAND_2016","YEAR_OF_THE_ROOSTER_2017","HALLOWEEN_2016"],r=["ana","bastion","dva","genji","hanzo","junkrat","lucio","mccree","mei","mercy","pharah","reaper","reinhardt","roadhog","soldier-76","sombra","symmetra","torbjorn","tracer","widowmaker","winston","zarya","zenyatta"],n=e.filter(function(e){return t[e]});if(n.length)for(var a in t){if(!e.includes(a))break;for(var i in t[a])for(var o in t[a][i]){var s=o.split("-")[0];s="soldier"==s?"soldier-76":s,s=r.includes(s)?s:"all";var c="skinsEpic"==i||"skinsLegendary"==i?"skins":i;t[s]||(t[s]={}),t[s][c]||(t[s][c]={}),t[s][c][o]=t[a][i][o]}delete t[a]}}}],n=localStorage.getItem("migrations"),a=n?JSON.parse(n):[];return t?(console.info("Running Migrations"),a.length==r.length?void console.info("No migrations needed"):(localStorage.setItem("backup-data",JSON.stringify(t)),r.forEach(function(e){return a.includes(e.id)?console.info(e.name,"already dun"):(console.info("Running",e.name,"migration"),e.run(),void a.push(e.id))}),console.info("Finished Migrations"),localStorage.setItem("data",JSON.stringify(t)),void localStorage.setItem("migrations",JSON.stringify(a)))):(console.info("No data, no migrations needed"),a=[],r.forEach(function(e){a.push(e.id)}),void localStorage.setItem("migrations",JSON.stringify(a)))}),OWI.run(function(){var e=angular.fromJson(localStorage.getItem("settings"))||{},t=e.currentTheme||"standard",r=["events.min.css"];r.forEach(function(e){var r="../css/"+("standard"==t?e:"themes/"+t+"/"+e),n=document.createElement("link");n.rel="stylesheet",n.href=r,document.head.appendChild(n),setTimeout(function(){document.body.style.opacity=1},500)})}),OWI.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("heroes",{url:"/heroes/:id",resolve:{hero:["$q","DataService","$stateParams",function(e,t,r){var n=e.defer();return t.waitForInitialization().then(function(e){var t=e.heroes[r.id];t?n.resolve(t):n.reject("INVALID_HERO")}),n.promise}]},views:{main:{templateUrl:"templates/hero.html",controller:"HeroesCtrl as hero"},header:{templateUrl:"templates/header-hero.html"}}}).state("events",{url:"/events/:id",resolve:{event:["$q","DataService","$stateParams",function(e,t,r){var n=e.defer();return t.waitForInitialization().then(function(e){var t=e.events[r.id];t?n.resolve(t):n.reject("INVALID_EVENT")}),n.promise}]},views:{header:{templateUrl:"templates/header-event.html"},main:{templateUrl:"templates/event-container.html",controller:"UpdateCtrl"}}}).state("home",{url:"/",resolve:{data:["$q","DataService",function(e,t){var r=e.defer();return t.waitForInitialization().then(function(e){r.resolve(e)}),r.promise}]},views:{main:{templateUrl:"templates/home.html"}}}),t.otherwise("/")}]),OWI.run(["$rootScope","$state","DataService",function(e,t,r){e.$on("$stateChangeError",function(e,n,a,i,o,s){console.warn(s),"INVALID_HERO"==s?t.go("home"):t.go("event",{id:r.currentEvent})})}]),OWI.controller("MainCtrl",["$rootScope","$q","$document","$uibModal","DataService",function(e,t,r,n,a){var i=this;this.preview=!1,this.currentDate=Date.now(),this.showSidebar=!1,this.supportsWebM=!0,this.showNav=!1,a.waitForInitialization().then(function(e){i.events=e.events,i.heroes=e.heroes});var o=document.createElement("video");o.canPlayType?this.supportsWebM=""!==o.canPlayType('video/webm; codecs="vp8, opus"')&&""!==o.canPlayType('video/webm; codecs="vp9, opus"'):this.supportsWebM=!1,e.$on("$stateChangeSuccess",function(e,t,r){i.showNav=!1,"events"==t.name?(i.item=i.events[r.id],i.item.type="event"):"heroes"==t.name?(i.item=i.heroes[r.id],i.item.type="hero"):i.item={name:"Home"}});var s=function(e){e&&e.path&&t.all(e.path.map(function(e){return"sidebar"==e.id?t.resolve(!0):void t.resolve(!1)})).then(function(e){var t=e.filter(Boolean)[0];t||(i.showSidebar=!1,r.off("click",s))})};this.toggleSidebar=function(){return this.showSidebar=!this.showSidebar,this.showSidebar?void(this.showSidebar&&setTimeout(function(){r.on("click",s)},0)):void r.off("click",s)},this.openSettings=function(){n.open({templateUrl:"templates/modals/settings.html",controller:"SettingsCtrl",controllerAs:"settings"})},this.openAbout=function(){n.open({templateUrl:"templates/modals/about.html",controller:"SettingsCtrl",controllerAs:"settings"})},this.openTheme=function(){n.open({templateUrl:"templates/modals/themes.html",controller:"SettingsCtrl",controllerAs:"settings"})}}]),OWI.controller("SettingsCtrl",["$rootScope","$uibModalInstance","StorageService","DataService",function(e,t,r,n){var a=this;this.particles=r.getSetting("particles"),this.hdVideos=r.getSetting("hdVideos"),this.currentTheme=r.getSetting("currentTheme"),this.importErrors=null,this.close=function(){t.dismiss("close")},this.resetData=function(){localStorage.removeItem("data"),localStorage.removeItem("migrations"),location.reload()},this.toggleSetting=function(e,t){this[e]=!this[e],r.setSetting(e,this[e]),t&&location.reload()},this.data=angular.toJson(n.checked,2);var i=["emotes","icons","intros","poses","skins","sprays","voicelines"],o=Object.keys(n.heroes);this.importData=function(e,t){a.importErrors=null;try{e=angular.fromJson(a.data);var n=[];if(!Object.keys(e).length)return;for(var s in e){o.includes(s)||n.push("Unknown hero "+s);for(var c in e[s])i.includes(c)||n.push("Invalid hero template for "+s+", unknown key '"+c+"'")}if(n.length)return void(a.importErrors=n.join("\n"));a.importErrors=!1,t||(r.setData(e),location.reload())}catch(e){console.error(e),a.importErrors="An error occured while parsing the JSON"}},this.selectTheme=function(e){this.currentTheme=e,r.setSetting("currentTheme",e),location.reload()},this.selectAll=function(){for(var t in n.heroes){var a=n.heroes[t].items;for(var i in a)a[i].forEach(function(e){n.checked[t][i]||(n.checked[t][i]={}),n.checked[t][i][e.id]=!0})}r.setData(n.checked),e.$emit("selectAll")}}]),OWI.controller("HeroesCtrl",["$scope","$rootScope","DataService","StorageService","hero",function(e,t,r,n,a){function i(e){return!e.achievement&&e.quality&&!e.standardItem&&(!e.event||e.event&&"SUMMER_GAMES_2016"!==e.event)}function o(t){var n=0,o={total:0,remaining:0,prev:e.cost.remaining};Object.keys(a.items).forEach(function(e){var c={total:0,selected:0};a.items[e].forEach(function(l){l.standardItem||(t&&s.totals.total++,c.total++);var m=r.isItemChecked(a.id,e,l.id);if(m&&!l.standardItem&&(n++,c.selected++),"all"==a.id&&(l.quality="common"),"icons"!==e&&i(l)){var d=r.prices[l.quality]*(l.event?3:1);o.total+=d,m||(o.remaining+=d)}}),s.totals.groups[e]=c}),e.cost=o,s.totals.selected=n,s.totals.percentage=s.totals.selected/s.totals.total*100+"%"}var s=this;Object.assign(this,a),this.gridView=!1,this.checked=r.checked[a.id],this.totalItems=0,this.selectedItems=0,this.itemPercentage=0,this.totals={total:0,selected:0,percentage:0,groups:{}},e.cost={total:0,remaining:0,prev:0},t.$on("selectAll",function(){o()}),this.onSelect=function(){n.setData(Object.assign({},r.checked,s.checked[a.id])),o()},this.toggleGrid=function(){"all"==a.id&&(this.gridView=!this.gridView)},this.selectAll=function(){s.totals.selected!=s.totals.total&&(Object.keys(a.items).forEach(function(e){a.items[e].forEach(function(t){s.checked[e][t.id]=!0})}),o(),n.setData(Object.assign({},r.checked,s.checked[a.id])))},o(!0)}]),OWI.controller("UpdateCtrl",["$scope","$rootScope","DataService","StorageService","event",function(e,t,r,n,a){e.preview=!1,e.checked=r.checked,e.data=a,t.$on("selectAll",function(){e.calculateCosts()}),e.onSelect=function(){n.setData(e.checked),e.calculateCosts()},e.cost={total:0,remaining:0,prev:0};var i={skinsEpic:"skins",skinsLegendary:"skins"};e.calculateCosts=function(){if("SUMMER_GAMES_2016"!=e.data.id){var t={total:0,remaining:0,prev:e.cost.remaining};Object.keys(e.data.items).forEach(function(n){if("icons"!=n){var a=e.data.items[n];a.forEach(function(e){if(e.quality){var a=3*r.prices[e.quality];t.total+=a,r.isItemChecked(e.heroID,i[n]||n,e.id)||(t.remaining+=a)}})}}),e.cost=t}},e.calculateCosts();var o=void 0,s=void 0;e.showPreview=function(t,r){if((t.img||t.video)&&!o){var a=angular.copy(t);clearTimeout(s),o=setTimeout(function(){a.type=r,n.getSetting("hdVideos")&&a.video&&(a.video=a.video.replace(".webm","-hd.webm")),e.preview=a,e.$digest()},e.preview?50:600)}},e.hidePreview=function(){clearTimeout(o),o=void 0,s=setTimeout(function(){e.preview=!1,e.$digest()},150)}}]);var types={portrait:"/portrait.png",career:"/career-portrait.png",icon:"/icon.png"};OWI.filter("heroImg",function(){return function(e,t){return"all"==e?"./resources/logo.svg":"./resources/heroes/"+e+types[t]}}),OWI.filter("eventImageUrl",function(){return function(e){return"./resources/updates/"+e+"/logo.png"}}),OWI.filter("itemPrice",function(){return function(e,t){var r=e.event,n=e.quality;if(e.standardItem||e.achievement||"icons"==t||r&&"SUMMER_GAMES_2016"==r)return"";var a={common:25,rare:75,epic:250,legendary:1e3};return n&&a[n]?"("+a[n]*(r?3:1)+")":""}}),OWI.directive("eventItem",function(){return{restrict:"E",replace:!0,templateUrl:"templates/event-item.html",link:function(e,t,r){e.type=r.type,e.noHero=r.nohero,e.noName=r.noname}}}),OWI.directive("scroll",["$window",function(e){return function(t){angular.element(e).bind("scroll",function(){this.innerWidth>1570||(t.isFixed=this.pageYOffset>=200,t.$apply())})}}]),OWI.directive("tooltipImagePreview",["StorageService",function(e){return{restrict:"E",replace:!0,scope:{item:"=data",type:"=type",hero:"=hero",supportsWebM:"=support"},templateUrl:"templates/tooltip-image-preview.html",link:function(t){var r=angular.copy(t.item);r.type=t.type,"intros"==r.type||"emotes"==r.type?r.video="/resources/heroes/"+(r.hero||t.hero)+"/"+r.type+"/"+r.id+".webm":r.img="/resources/heroes/"+(r.hero||t.hero)+"/"+r.type+"/"+r.id+("sprays"==r.type||"icons"==r.type?".png":".jpg"),e.getSetting("hdVideos")&&r.video&&(r.video=r.video.replace(".webm","-hd.webm")),t.preview=r}}}]),OWI.directive("legendarySkins",function(){return{restrict:"E",replace:!0,templateUrl:"templates/legendary-skins.html",link:function(e,t,r){e.ss=r.ss,e.ssURL=r.ssurl}}}),OWI.directive("subHeader",function(){return{restrict:"E",replace:!0,templateUrl:"templates/sub-header.html"}}),OWI.directive("heroNav",function(){return{restrict:"E",replace:!0,templateUrl:"templates/hero-nav.html"}}),OWI.directive("countTo",["$timeout","$filter",function(e,t){return{replace:!1,scope:!0,link:function(r,n,a){var i,o,s,c,l,m,d,h=n[0],u=function(){o=30,l=0,r.timoutId=null,m=parseInt(a.countTo)||0,r.value=parseInt(a.countFrom,10)||0,s=1e3*parseFloat(a.duration)||0,c=Math.ceil(s/o),d=(m-r.value)/c,i=r.value},g=function(){r.timoutId=e(function(){i+=d,l++,l>=c?(e.cancel(r.timoutId),i=m,h.textContent=t("number")(Math.round(m))):(h.textContent=t("number")(Math.round(i)),g())},o)},p=function(){r.timoutId&&e.cancel(r.timoutId),u(),g()};return a.$observe("countTo",function(e){e&&p()}),a.$observe("countFrom",function(){p()}),!0}}}]),OWI.directive("loadingSpinner",function(){return{restrict:"E",scope:{},replace:!0,template:'<div class="loader"><ul class="hexagon-container"><li class="hexagon hex_1"></li><li class="hexagon hex_2"></li><li class="hexagon hex_3"></li><li class="hexagon hex_4"></li><li class="hexagon hex_5"></li><li class="hexagon hex_6"></li><li class="hexagon hex_7"></li></ul></div>'}}),OWI.directive("lazyBackground",["$document","$compile",function(e,t){return{restrict:"A",scope:{},link:function(r,n,a){a.$observe("lazyBackground",function(a){if(null==a||""==a)return n.css("background-image",""),void n.addClass("img-load-error");n.removeClass("img-load-error"),n.addClass("img-loading");var i=t("<loading-spinner  />")(r);n.prepend(i),setTimeout(function(){i.css("opacity","1")},110);var o=e[0].createElement("img");o.onload=function(){n.css("background-image",'url("'+this.src+'")'),n.removeClass("img-loading"),i.remove()},o.onerror=function(){n.css("background-image",""),n.removeClass("img-loading"),n.addClass("img-load-error"),i.remove()},o.src=encodeURI(a)})}}}]),OWI.factory("StorageService",function(){var e={data:{},settings:{},defaultSettings:{particles:!0,hdVideos:!1,currentTheme:"standard"},getData:function(){return e.data},getSetting:function(t){return e.settings[t]?e.settings[t]:!!e.defaultSettings[t]&&e.defaultSettings[t]},setSetting:function(t,r){e.settings[t]=r,e.persist(!0)},setData:function(t){e.data=t,e.persist()},persist:function(t){localStorage.setItem(t?"settings":"data",angular.toJson(e[t?"settings":"data"]))},init:function(){console.info("Init StorageService");var t=localStorage.getItem("data");t&&(e.data=angular.fromJson(t));var r=localStorage.getItem("settings");r?e.settings=angular.fromJson(r):e.settings=e.defaultSettings}};return e.init(),e}),OWI.factory("DataService",["$http","$q","StorageService",function(e,t,r){function n(e){console.info("Initializing");var t=r.getData()||{},n={initialized:!0,checked:{}};for(var i in e.heroes)n.checked[i]={skins:{},emotes:{},intros:{},sprays:{},voicelines:{},poses:{},icons:{}};Object.assign(n.checked,t),Object.assign(a,n,e)}var a={checked:{},prices:{},events:{},heroes:{},initialized:!1,isItemChecked:function(e,t,r){return!!a.checked[e]&&(!!a.checked[e][t]&&a.checked[e][t][r])},waitForInitialization:function(){return t(function(e){function t(){a.initialized?e(a):setTimeout(t,50)}t()})},init:function(){console.info("Fetching Data"),e.get("./data/master.json").then(function(e){200==e.status?n(e.data):console.error("Failed loading master.json ???",e.status,e.error)},function(e){console.error("Failed loading master.json ???",e.status,e.error)})}};return a.init(),a}]);